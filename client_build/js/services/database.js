"use strict";var databaseModule=angular.module("app.database",["ngResource"]);databaseModule.service("db",["$http","$q","$resource",function(t,e,a){var r={};r.Defs=a("/api/defs.php",{},{get:{method:"GET",isArray:!0,cache:!0}}),r.Schedule=a("/api/schedule/schedule.php"),r.Show=a("/api/shows/shows.php");var n=null;this.getAlbumArt=function(a,r){return n=n||t.get("/api/auth/spotify.php").then(function(t){return t.data}),n.then(function(n){var h=a.map(function(a){return""===a.lb_album?e.resolve(a):t.get("https://api.spotify.com/v1/search",{cache:!0,headers:{Authorization:"Bearer "+n.access_token},params:{type:"album",limit:1,q:"artist:"+a.lb_artist+" album:"+a.lb_album}}).then(function(t){var e=t.data.albums.items[0];if(e){var n=_.find(e.images,{height:r})||{};a.imageUrl=n.url}return a},function(){return a})});return e.all(h)})},this.getDefs=function(t){return r.Defs.get({table:t})},this.Blog={},this.Blog.getPreview=function(){return t.get("/api/blog/preview.php").then(function(t){return t.data})},this.Charts={},this.Charts.getTopAlbums=function(e,a,r){return t.get("/api/charts/albums.php",{params:{date1:Math.floor(e/1e3),date2:Math.floor(a/1e3),general_genreID:r}}).then(function(t){return t.data})},this.Charts.getTopTracks=function(e,a){return t.get("/api/charts/tracks.php",{params:{date1:Math.floor(e/1e3),date2:Math.floor(a/1e3)}}).then(function(t){return t.data})},this.Schedule={},this.Schedule.get=function(t){return r.Schedule.query({day:t})},this.Show={},this.Show.getShows=function(t,e){return r.Show.query({page:t,term:e})},this.Show.getPlaylist=function(e){return t.get("/api/shows/playlist.php",{params:{showID:e}}).then(function(t){return t.data})},this.Show.getNowPlaying=function(){return t.get("/api/shows/now.php").then(function(t){return t.data})}}]);