"use strict";var libraryModule=angular.module("wizbif.library",["ui.router","wizbif.alert","wizbif.database"]);libraryModule.controller("LibraryCtrl",["$scope","$q","$state","$window","alert","db",function(e,t,r,n,a,u){e.rotations=u.getDefs("rotations"),e.general_genres=u.getDefs("general_genres"),e.rotationID=r.params.rotationID,e.general_genreID=r.params.general_genreID,e.query=r.params.query,e.page=Number.parseInt(r.params.page),e.albums=[],e.selectedAll=!1,e.go=function(e,t,n,a,u){var l=u?"library-admin":"library";r.go(l,{rotationID:e,general_genreID:t,query:n,page:a})},e.checkoutAlbum=function(e){u.Library.checkoutAlbum(e).then(function(){r.reload(),a.success("Album checked out.")},function(e){a.error(e.data||e.statusText)})},e.returnAlbum=function(e){u.Library.returnAlbum(e).then(function(){r.reload(),a.success("Album returned.")},function(e){a.error(e.data||e.statusText)})},e.setSelectedAll=function(t){e.selectedAll=t,e.albums.forEach(function(e){e.selected=t})},e.moveRotation=function(t){t=t.filter(function(e){return e.selected}).map(function(e){return{albumID:e.albumID}}),u.Library.moveRotation(t).then(function(){e.albums=e.albums.filter(function(e){return!e.selected}),a.success("Rotation successfully moved.")},function(e){a.error(e.data||e.statusText)})},e.printLabels=function(e){e=e.filter(function(e){return e.selected}).map(function(e){return{albumID:e.albumID}});var t=e.map(function(e){return"albums[]="+e.albumID}).join("&");n.open("/api/library/print_labels.php?"+t)},e.deleteAlbums=function(e){if(e=e.filter(function(e){return e.selected}),confirm("Delete "+e.length+" albums?")){var n=e.map(function(e){return u.Library.deleteAlbum(e.albumID)});t.all(n).then(function(){r.reload(),a.success("Albums deleted.")},function(e){a.error(e.data||e.statusText)})}},u.Library.getLibrary(e.rotationID,e.general_genreID,e.query,e.page).then(function(t){e.albums=t})}]),libraryModule.controller("LibraryAlbumCtrl",["$scope","$state","db","alert",function(e,t,r,n){e.rotations=r.getDefs("rotations"),e.general_genres=r.getDefs("general_genres"),e.airability=r.getDefs("airability"),e.album={},e.related_artists=[];var a=function(t){r.Library.getAlbum(t).then(function(t){return e.album=t,r.Library.getRelatedArtists(t.artist_name)}).then(function(t){e.related_artists=t})};e.save=function(e){r.Library.saveAlbum(e).then(function(){t.go("library-admin"),n.success("Album successfully saved.")},function(e){n.error(e.data||e.statusText)})},e.review=function(e){r.Library.reviewAlbum(e).then(function(){t.go("library"),n.success("Album successfully reviewed!")},function(e){n.error(e.data||e.statusText)})},a(t.params.albumID)}]);