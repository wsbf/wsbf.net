"use strict";var logbookModule=angular.module("wizbif.logbook",["wizbif.alert","wizbif.database"]);logbookModule.controller("LogbookCtrl",["$scope","$interval","alert","db",function(n,t,o,e){n.days=e.getDefs("days"),n.show_times=e.getDefs("show_times"),n.showID=null,n.show={},n.listenerCount=0,n.playlists=[],n.newTrack={disc_num:1};var a=function(){e.Logbook.getCurrentShow().then(function(t){var o=_.find(n.user.shows||[],{scheduleID:t.scheduleID});n.scheduleID=(o||{}).scheduleID,n.showID=n.scheduleID&&t.showID,n.show=t},function(){n.show=null})},s=function(){e.Logbook.getListenerCount().then(function(t){n.listenerCount=t})},i=function(){e.Playlist.getPlaylists().then(function(t){n.playlists=t})};n.signOn=function(n){e.Logbook.signOn(n).then(function(){a(),o.success("Successfully signed on.")},function(n){o.error(n.data||n.statusText)})},n.signOff=function(){e.Logbook.signOff().then(function(){a(),o.success("Successfully signed off.")},function(n){o.error(n.data||n.statusText)})},n.addPlaylist=function(t,o){e.Playlist.get(o).$promise.then(function(o){o.tracks.forEach(function(n){n.rotation=n.rotation||"O",t.unshift(n)}),n.playlistID=null})},n.getAlbum=function(t){e.Logbook.getAlbum(t).then(function(t){n.newTrack.albumID=t.albumID,n.newTrack.rotation=t.rotation,n.newTrack.artist_name=t.artist_name,n.newTrack.album_name=t.album_name,n.newTrack.label=t.label})},n.getTrack=function(t,o,a){e.Logbook.getTrack(t,o,a).then(function(t){n.newTrack.track_name=t.track_name,n.newTrack.airabilityID=t.airabilityID})},n.addTrack=function(t,o){o.rotation=o.rotation||"O",t.unshift(o),n.newTrack={disc_num:1}},n.logTrack=function(n){e.Logbook.logTrack(n).then(function(){n.logged=!0,o.success("Successfully logged track.")},function(n){o.error(n.data||n.statusText)})},a(),s(),i();var c=t(s,5e3);n.$on("$destroy",function(){t.cancel(c)})}]);