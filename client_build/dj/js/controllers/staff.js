"use strict";var staffModule=angular.module("wizbif.staff",["wizbif.database"]);staffModule.controller("StaffCtrl",["$scope","alert","db",function(e,t,n){e.positions=n.getDefs("positions"),e.staff=[],e.newMember={};var r=function(){n.Staff.get().then(function(t){e.staff=e.positions.map(function(e){return _.find(t,{positionID:e.positionID})})})};e.searchUsers=function(e){return n.Users.search(e).then(function(e){return e.forEach(function(e){e.name=e.preferred_name===e.first_name+" "+e.last_name?e.preferred_name:e.first_name+" "+e.last_name+" ("+e.preferred_name+")"}),e})},e.addStaffMember=function(r,f){if(r[f.positionID])t.error("Cannot add a staff member to a non-empty position.");else{var s={positionID:f.positionID,username:f.user.username,preferred_name:f.user.preferred_name};n.Staff.addMember(s).then(function(){t.success("Staff member successfully added."),r[f.positionID]=s,e.newMember={}},function(e){t.error(e.data||e.statusText)})}},e.removeStaffMember=function(e,r){confirm("Remove "+e[r].preferred_name+" from staff position?")&&n.Staff.removeMember(r).then(function(){t.success("Staff member successfully removed."),e[r]=null},function(e){t.error(e.data||e.statusText)})},e.positions.$promise.then(r)}]);