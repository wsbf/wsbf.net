"use strict";var fishbowlAdminModule=angular.module("wizbif.fishbowl-admin",["wizbif.alert","wizbif.database"]);fishbowlAdminModule.controller("FishbowlAdminCtrl",["$scope","$rootScope","$uibModal","db","alert",function(e,i,o,t,n){e.apps=[],e.bowls=[];var s=function(){return t.Fishbowl.get().then(function(i){e.apps=i})};e.archiveFishbowl=function(){confirm("Are you sure you want to archive the fishbowl?")&&t.Fishbowl.archive().then(function(){s(),n.success("Fishbowl archived.")},function(e){n.error(e.data||e.statusText)})},e.review=function(e,t){o.open({templateUrl:"views/fishbowl_review.html",controller:"FishbowlReviewCtrl",scope:angular.extend(i.$new(),{apps:e,fishbowlID:t})})},e.rateFishbowlApps=function(e){e.some(function(e){return!e.rating})||(e=e.map(function(e){return{fishbowlID:e.fishbowlID,rating:e.rating}}),t.Fishbowl.rateApps(e).then(function(){s(),n.success("Fishbowl ratings updated.")},function(e){n.error(e.data||e.statusText)}))},e.getFishbowlResults=function(i){i=i.slice().sort(function(e,i){return i.average-e.average});for(var o=5,t=Math.ceil(i.length/o),n=[],s=0;s<o;s++)n[s]=_.shuffle(i.splice(0,t));e.bowls=n},s()}]),fishbowlAdminModule.controller("FishbowlReviewCtrl",["$scope","db",function(e,i){e.fishbowl_log_types=i.getDefs("fishbowl_log_types"),e.index=-1,e.app={},e.get=function(o,t){var n=o[t].fishbowlID;i.Fishbowl.getApp(n).then(function(i){e.index=t,e.app=i})},e.get(e.apps,_.findIndex(e.apps,{fishbowlID:e.fishbowlID}))}]);